<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ç« ç¼–è¾‘å·¥å…·</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="logo">æ–‡ç« ç¼–è¾‘å·¥å…·</div>
            <ul class="nav-links">
                <li><a href="index.html">è¿”å›é¦–é¡µ</a></li>
                <li><a href="https://github.com/Daniel-0429/Daniel-0429.github.io/issues" target="_blank">ä»“åº“Issues</a></li>
		<!-- æ–°å¢ï¼šæš—è‰²æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
<li>
    <button class="theme-toggle" id="themeToggle" aria-label="åˆ‡æ¢æš—è‰²æ¨¡å¼">
        <i class="fas fa-moon"></i>
    </button>
</li>
            </ul>
        </div>
    </nav>

    <section class="admin-section">
        <div class="container">
            <!-- ç™»å½•éªŒè¯ï¼ˆç®€å•å¯†ç ï¼‰ -->
            <div class="login-form" id="login-form">
                <h3>ç¼–è¾‘å·¥å…·ç™»å½•</h3>
                <input type="password" id="admin-pwd" placeholder="è¾“å…¥ç®¡ç†å¯†ç ">
                <button id="login-btn">ç™»å½•</button>
            </div>

            <!-- æ–‡ç« ç¼–è¾‘é¢æ¿ -->
            <div class="admin-panel" id="admin-panel" style="display: none;">
                <div class="article-form">
                    <h3>æ–°å¢/ç¼–è¾‘æ–‡ç« </h3>
                    <input type="hidden" id="article-id">
                    <div class="form-group">
                        <label>æ ‡é¢˜</label>
                        <input type="text" id="article-title" placeholder="æ–‡ç« æ ‡é¢˜">
                    </div>
                    <div class="form-group">
                        <label>æ‘˜è¦</label>
                        <textarea id="article-desc" placeholder="æ–‡ç« æ‘˜è¦ï¼ˆç®€çŸ­æè¿°ï¼‰"></textarea>
                    </div>
                    <div class="form-group">
                        <label>å†…å®¹ï¼ˆæ”¯æŒMarkdownï¼‰</label>
                        <textarea id="article-content" rows="10" placeholder="æ–‡ç« å†…å®¹"></textarea>
                    </div>
                    <div class="form-group">
                        <label>æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                        <input type="text" id="article-tags" placeholder="ä¾‹å¦‚ï¼šå‰ç«¯,JavaScript,React">
                    </div>
                    <button id="generate-json">ç”ŸæˆJSON</button>
                    <button id="clear-form" style="margin-left: 10px;">æ¸…ç©ºè¡¨å•</button>
                </div>

                <!-- JSONé¢„è§ˆåŒº -->
                <div class="json-preview">
                    <h3>æ–‡ç« JSONé¢„è§ˆï¼ˆå¤åˆ¶åˆ°GitHub Issueï¼‰</h3>
                    <textarea id="json-output" rows="8" readonly></textarea>
                    <button id="copy-json">å¤åˆ¶JSON</button>
                    <div class="tips">
                        <p>ğŸ“Œ æ“ä½œæŒ‡å¼•ï¼š</p>
                        <p>1. å¡«å†™è¡¨å•åç‚¹å‡»ã€Œç”ŸæˆJSONã€</p>
                        <p>2. å¤åˆ¶JSONåˆ°ä»“åº“Issuesï¼Œåˆ›å»ºæ ‡é¢˜ä¸ºã€Œæ–°å¢æ–‡ç« ã€çš„Issueï¼ˆç¼–è¾‘åˆ™æ ‡é¢˜ä¸ºã€Œç¼–è¾‘æ–‡ç« ã€ï¼‰</p>
                        <p>3. åˆ é™¤æ–‡ç« ï¼šç»™ä»»æ„Issueæ·»åŠ æ ‡ç­¾ <code>delete-article-æ–‡ç« ID</code></p>
                    </div>
                </div>

                <!-- ç°æœ‰æ–‡ç« åˆ—è¡¨ -->
                <div class="admin-articles">
                    <h3>ç°æœ‰æ–‡ç« ï¼ˆç‚¹å‡»å¤åˆ¶IDï¼‰</h3>
                    <div id="admin-articles-list">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
    </section>

    <script>
        const ADMIN_PASSWORD = "admin123";
        const ISSUES_URL = "https://github.com/Daniel-0429/Daniel-0429.github.io/issues";

        // DOMå…ƒç´ 
        const loginForm = document.getElementById('login-form');
        const adminPanel = document.getElementById('admin-panel');
        const loginBtn = document.getElementById('login-btn');
        const adminPwd = document.getElementById('admin-pwd');
        const generateJsonBtn = document.getElementById('generate-json');
        const clearFormBtn = document.getElementById('clear-form');
        const jsonOutput = document.getElementById('json-output');
        const copyJsonBtn = document.getElementById('copy-json');
        const articleId = document.getElementById('article-id');
        const articleTitle = document.getElementById('article-title');
        const articleDesc = document.getElementById('article-desc');
        const articleContent = document.getElementById('article-content');
        const articleTags = document.getElementById('article-tags');
        const adminArticlesList = document.getElementById('admin-articles-list');

        // ç™»å½•éªŒè¯
        loginBtn.addEventListener('click', () => {
            if (adminPwd.value === ADMIN_PASSWORD) {
                loginForm.style.display = 'none';
                adminPanel.style.display = 'block';
                loadArticles(); // åŠ è½½ç°æœ‰æ–‡ç« 
            } else {
                alert('å¯†ç é”™è¯¯ï¼');
            }
        });

        // åŠ è½½ç°æœ‰æ–‡ç« 
        async function loadArticles() {
            try {
                // ç›´æ¥è¯»å–GitHub Pagesä¸Šçš„articles.jsonï¼ˆæ— Tokenï¼‰
                const response = await fetch(`./data/articles.json?t=${Date.now()}`, { cache: 'no-cache' });
                const data = await response.json();
                const articles = data.articles || [];

                if (articles.length === 0) {
                    adminArticlesList.innerHTML = '<p>æš‚æ— æ–‡ç« </p>';
                    return;
                }

                // æ¸²æŸ“æ–‡ç« åˆ—è¡¨ï¼ˆç‚¹å‡»å¤åˆ¶IDï¼‰
                adminArticlesList.innerHTML = articles.map(art => `
                    <div class="admin-article-item">
                        <h4>${art.title}</h4>
                        <div>
                            <span class="article-id" onclick="copyText('${art.id}')">ID: ${art.id}</span>
                            <button onclick="fillForm('${art.id}')">å¡«å……åˆ°è¡¨å•</button>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                adminArticlesList.innerHTML = `<p>åŠ è½½å¤±è´¥ï¼š${err.message}</p>`;
            }
        }

        // ç”Ÿæˆæ–‡ç« JSON
        generateJsonBtn.addEventListener('click', () => {
            const id = articleId.value || Date.now().toString();
            const title = articleTitle.value.trim();
            const desc = articleDesc.value.trim();
            const content = articleContent.value.trim();
            const tags = articleTags.value.split(',').map(tag => tag.trim()).filter(tag => tag);

            if (!title || !content) {
                alert('æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©ºï¼');
                return;
            }

            // æ„é€ æ–‡ç« æ•°æ®
            const articleData = {
                id: id,
                title: title,
                desc: desc,
                content: content,
                tags: tags,
                createTime: articleId.value ? undefined : new Date().toISOString(),
                updateTime: articleId.value ? new Date().toISOString() : undefined
            };

            // æ ¼å¼åŒ–JSONï¼ˆç¾è§‚æ˜“è¯»ï¼‰
            const jsonStr = JSON.stringify(articleData, null, 2);
            jsonOutput.value = jsonStr;
        });

        // æ¸…ç©ºè¡¨å•
        clearFormBtn.addEventListener('click', () => {
            articleId.value = '';
            articleTitle.value = '';
            articleDesc.value = '';
            articleContent.value = '';
            articleTags.value = '';
            jsonOutput.value = '';
        });

        // å¤åˆ¶JSON
        copyJsonBtn.addEventListener('click', async () => {
            if (!jsonOutput.value) {
                alert('æš‚æ— JSONå¯å¤åˆ¶ï¼');
                return;
            }
            await navigator.clipboard.writeText(jsonOutput.value);
            alert('JSONå¤åˆ¶æˆåŠŸï¼è¯·å‰å¾€Issuesç²˜è´´');
            // è‡ªåŠ¨æ‰“å¼€Issuesé¡µé¢
            window.open(ISSUES_URL, '_blank');
        });

        // å¡«å……è¡¨å•ï¼ˆç¼–è¾‘æ–‡ç« ï¼‰
        window.fillForm = async function(id) {
            const response = await fetch(`./data/articles.json?t=${Date.now()}`, { cache: 'no-cache' });
            const data = await response.json();
            const article = data.articles.find(art => art.id === id);
            if (!article) return;

            articleId.value = article.id;
            articleTitle.value = article.title;
            articleDesc.value = article.desc;
            articleContent.value = article.content;
            articleTags.value = article.tags.join(',');
            // ç”Ÿæˆç¼–è¾‘ç”¨çš„JSON
            generateJsonBtn.click();
        };

        // å¤åˆ¶æ–‡æœ¬ï¼ˆå¦‚æ–‡ç« IDï¼‰
        window.copyText = async function(text) {
            await navigator.clipboard.writeText(text);
            alert(`å·²å¤åˆ¶ï¼š${text}`);
        };
    </script>
    <!-- æš—è‰²æ¨¡å¼åˆ‡æ¢è„šæœ¬ -->
<script>
    // åˆå§‹åŒ–ä¸»é¢˜
    const initTheme = () => {
        // ä¼˜å…ˆè¯»å–æœ¬åœ°å­˜å‚¨çš„ä¸»é¢˜
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme) {
            document.documentElement.setAttribute('data-theme', savedTheme);
        } else if (prefersDark) {
            document.documentElement.setAttribute('data-theme', 'dark');
        }
        
        // æ›´æ–°æŒ‰é’®å›¾æ ‡
        updateThemeIcon();
    };

    // æ›´æ–°åˆ‡æ¢æŒ‰é’®å›¾æ ‡
    const updateThemeIcon = () => {
        const toggleBtn = document.getElementById('themeToggle');
        const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        toggleBtn.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    };

    // åˆ‡æ¢ä¸»é¢˜
    const toggleTheme = () => {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme); // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        updateThemeIcon();
    };

    // åˆå§‹åŒ–
    initTheme();

    // ç»‘å®šåˆ‡æ¢äº‹ä»¶
    document.getElementById('themeToggle').addEventListener('click', toggleTheme);

    // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (!localStorage.getItem('theme')) { // ä»…å½“ç”¨æˆ·æœªæ‰‹åŠ¨åˆ‡æ¢æ—¶ï¼Œè·Ÿéšç³»ç»Ÿ
            const newTheme = e.matches ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            updateThemeIcon();
        }
    });
</script>

<!-- å¼•å…¥Font Awesomeå›¾æ ‡ï¼ˆç¡®ä¿å›¾æ ‡æ˜¾ç¤ºï¼‰ -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</body>
</html>